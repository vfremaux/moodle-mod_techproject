<?php
    require_once("{$CFG->dirroot}/mod/techproject/lib.php");  // for parameter arrays
    require_once("{$CFG->dirroot}/mod/techproject/locallib.php");  // for parameter arrays

    // ...and fill the form if needed
    if (empty($form->name)) {
        $form->name = "";
    }
    if (empty($form->description)) {
        $form->description = "";
    }
    if (empty($form->format)) {
        $form->format = "";
    }
    if (empty($form->projectstart)) {
        $form->projectstart = time();
    }    
    if (empty($form->assessmentstart)) {
        $form->assessmentstart = time();
    }
    if (empty($form->projectend)) {
        $form->projectend = time();
    } 
    if (empty($form->timeunit)) {
        $form->timeunit = time();
    } 
    if (empty($form->costunit)) {
        $form->costunit = 'euros';
    } 
    if (empty($form->guestsallowed)) {
        $form->guestsallowed = 1;
    } 
    if (empty($form->guestscanuse)) {
        $form->guestscanuse = 0;
    } 
    if (empty($form->ungroupedsees)) {
        $form->ungroupedsees = 0;
    } 
    if (empty($form->allowdeletewhenassigned)) {
        $form->allowdeletewhenassigned = 1;
    } 
    if (!isset($form->projectusesrequs)) {
        $form->projectusesrequs = 1;
    } 
    if (!isset($form->projectusesspecs)) {
        $form->projectusesspecs = 1;
    } 
    if (!isset($form->projectusesdelivs)) {
        $form->projectusesdelivs = 1;
    } 
    if (!isset($form->projectusesvalidations)) {
        $form->projectusesvalidations = 1;
    } 
    if (empty($form->teacherusescriteria)) {
        $form->teacherusescriteria = 0;
    } 
    if (empty($form->allownotifications)) {
        $form->allownotifications = 0;
    } 
    if (empty($form->autogradingenabled)) {
        $form->autogradingenabled = 0;
    } 
    if (empty($form->autogradingweight)) {
        $form->autogradingweight = 0;
    } 
    if (!isset($form->grade)) {
        $form->grade = 100;
    }
    if (empty($form->enablecvs)) {
        $form->enablecvs = 0;
    } 
?>

<form name="form" method="post" action="mod.php">
<table cellpadding="5">
<tr valign="top">
    <td align="right"><b><?php  print_string('title', 'techproject') ?>:</b></td>
    <td>
        <input type="text" name="name" size="60" value="<?php  p($form->name) ?>" alt="<?php print_string('title', 'techproject') ?>" />
    </td>
</tr>
<tr valign="top">
    <td align="right"><b><?php  print_string('description', 'techproject') ?>:</b><br />
    <font size="1">
     <?php
        helpbutton('writing', get_string('helpwriting'), 'moodle', true, true);
        echo "<br />";
        if ($usehtmleditor) {
           helpbutton('richtext', get_string('helprichtext'), 'moodle', true, true);
        } else {
           helpbutton('text', get_string('helptext'), 'moodle', true, true);
           echo "<br />";
           emoticonhelpbutton('form', 'description', 'moodle', true, true);
           echo "<br />";
        }
      ?>
      <br />
    </font>
    </td>
    <td>
    <?php
       print_textarea($usehtmleditor, 20, 60, 595, 400, 'description', $form->description);

       if ($usehtmleditor) {
           echo '<input type="hidden" name="format" value="'.FORMAT_HTML.'" />';
       } else {
           echo '<p align="right">';
           helpbutton('textformat', get_string('formattexttype'));
           print_string('formattexttype');
           echo ':&nbsp;';
           if (!$form->format) {
               $form->format = $defaultformat;
           }
           choose_from_menu(format_text_menu(), 'format', $form->format, "");
           echo '</p>';
       }
    ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('projectstart', 'techproject') ?>:</b></td>
    <td><?php
            print_date_selector('projectstartday', 'projectstartmonth', 'projectstartyear', $form->projectstart);
            echo "&nbsp;-&nbsp;";
            print_time_selector('projectstarthour', 'projectstartminute', $form->projectstart);
            helpbutton('projectstart', get_string('projectstart', 'techproject'), 'techproject');
    ?></td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('projectend', 'techproject') ?>:</b></td>
    <td><?php
            print_date_selector('projectendday', 'projectendmonth', 'projectendyear', $form->projectend);
            echo "&nbsp;-&nbsp;";
            print_time_selector('projectendhour', 'projectendminute', $form->projectend);
            helpbutton("projectend", get_string('projectend', 'techproject'), 'techproject');
    ?></td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('assessmentstart', 'techproject') ?>:</b></td>
    <td><?php
            print_date_selector('assessmentstartday', 'assessmentstartmonth', 'assessmentstartyear', $form->assessmentstart);
            echo "&nbsp;-&nbsp;";
            print_time_selector('assessmentstarthour', 'assessmentstartminute', $form->assessmentstart);
            helpbutton('assessmentstart', get_string('assessmentstart', 'techproject'), 'techproject');
    ?></td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('timeunit', 'techproject') ?>:</b></td>
    <td>
        <?php 
        $unitoptions[HOURS] = get_string('hours', 'techproject');
        $unitoptions[HALFDAY] = get_string('halfdays', 'techproject');
        $unitoptions[DAY] = get_string('days', 'techproject');
        choose_from_menu($unitoptions, 'timeunit', $form->timeunit, 'choose'); 
        ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('projectelements', 'techproject') ?>:</b></td>
    <td>
    	<table>
    		<tr>
    			<td>
			    	<input type="checkbox" name="projectusesrequs" value="1" <?php if ($form->projectusesrequs) echo ' checked="checked" ' ; ?> />
			    	<?php echo get_string('requirements', 'techproject')  ?>
    			</td>
    			<td>
			    	<input type="checkbox" name="projectusesspecs" value="1" <?php if ($form->projectusesspecs) echo ' checked="checked" ' ; ?> />
			    	<?php echo get_string('specifications', 'techproject')  ?>
    			</td>
    			<td>
			    	<input type="checkbox" name="projectusesdelivs" value="1" <?php if ($form->projectusesdelivs) echo ' checked="checked" ' ; ?> />
			    	<?php echo get_string('deliverables', 'techproject')  ?>
    			</td>
    			<td>
			    	<input type="checkbox" name="projectusesvalidations" value="1" <?php if ($form->projectusesvalidations) echo ' checked="checked" ' ; ?> />
			    	<?php echo get_string('validations', 'techproject')  ?>
    			</td>
    		</tr>
    	</table>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('costunit', 'techproject') ?>:</b></td>
    <td>
        <input type="text" size="20" name="costunit" value="<?php p($form->costunit) ?>" />
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('guestspermissions', 'techproject') ?>:</b></td>
    <td>
        <table width="100%">
            <tr>
                <td style="font-size : smaller">
                    <b><?php print_string('guestsallowed', 'techproject') ?>:</b>
                </td>
                <td style="font-size : smaller">
                    <b><?php print_string('guestscanuse', 'techproject') ?>:</b>
                </td>
                <td style="font-size : smaller">
                    <b><?php print_string('ungroupedsees', 'techproject') ?>:</b>
                </td>
            </tr>
            <tr>
                <td>
                    <input type="radio" value="0" name="guestsallowed" <?php echo (!$form->guestsallowed) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('no') ?>
                    <input type="radio" value="1" name="guestsallowed" <?php echo ($form->guestsallowed) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('yes') ?>
                    <?php helpbutton('guestsallowed', get_string('guestsallowed', 'techproject'), 'techproject'); ?>
                </td>
                <td>
                    <input type="radio" value="0" name="guestscanuse" <?php echo (!$form->guestscanuse) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('no') ?>
                    <input type="radio" value="1" name="guestscanuse" <?php echo ($form->guestscanuse) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('yes') ?>
                    <?php helpbutton('guestscanuse', get_string('guestscanuse', 'techproject'), 'techproject'); ?>
                </td>
                <td>
                    <input type="radio" value="0" name="ungroupedsees" <?php echo (!$form->ungroupedsees) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('no') ?>
                    <input type="radio" value="1" name="ungroupedsees" <?php echo ($form->ungroupedsees) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('yes') ?>
                    <?php helpbutton('ungroupedsees', get_string('ungroupedsees', 'techproject'), 'techproject'); ?>
                </td>
             </tr>
         </table>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('allowdeletewhenassigned', 'techproject') ?>:</b></td>
    <td>
        <input type="radio" value="0" name="allowdeletewhenassigned" <?php echo (!$form->allowdeletewhenassigned) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('no') ?>
        <input type="radio" value="1" name="allowdeletewhenassigned" <?php echo ($form->allowdeletewhenassigned) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('yes') ?>
        <?php helpbutton('allowdeletewhenassigned', get_string('allowdeletewhenassigned', 'techproject'), 'techproject'); ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('studentscanchange', 'techproject') ?>:</b></td>
    <td>
    (<?php print_string('seecapabilitysettings', 'techproject') ?>)
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('teacherusescriteria', 'techproject') ?>:</b></td>
    <td>
        <input type="radio" value="0" name="teacherusescriteria" <?php echo (!$form->teacherusescriteria) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('no') ?>
        <input type="radio" value="1" name="teacherusescriteria" <?php echo ($form->teacherusescriteria) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('yes') ?>
        <?php helpbutton('teacherusescriteria', get_string('teacherusescriteria', 'techproject'), 'techproject'); ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('autograde', 'techproject') ?>:</b></td>
    <td align="right">
        <table width="100%">
            <tr valign="top">
                <td style="font-size : smaller">
                    <b><?php print_string('autogradingenabled', 'techproject') ?>:</b>
                </td>
                <td style="font-size : smaller">
                    <b><?php print_string('autogradingweight', 'techproject') ?>:</b>
                </td>
            </tr>
            <tr>
                <td>
                    <input type="radio" value="0" name="autogradingenabled" <?php echo (!$form->autogradingenabled) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('no') ?>
                    <input type="radio" value="1" name="autogradingenabled" <?php echo ($form->autogradingenabled) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('yes') ?>
                    <?php helpbutton('autogradingenabled', get_string('autogradingenabled', 'techproject'), 'techproject'); ?>
                </td>
                <td>
                    <input type="text" value="<?php echo $form->autogradingweight ?>" name="autogradingweight" size="3" />
                    <?php helpbutton('autogradingweight', get_string('autogradingweight', 'techproject'), 'techproject'); ?>
                </td>
            </tr>
        </table>
    </td>
</tr>

<tr valign="top">
<td align="right"><b><?php print_string('grade') ?>:</b></td>
    <td>
        <?php
        print_grade_menu($course->id, 'grade', "$form->grade");
        ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('allownotifications', 'techproject') ?>:</b></td>
    <td>
        <input type="radio" value="0" name="allownotifications" <?php echo (!$form->allownotifications) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('no') ?>
        <input type="radio" value="1" name="allownotifications" <?php echo ($form->allownotifications) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('yes') ?>
        <?php helpbutton('allownotifications', get_string('allownotifications', 'techproject'), 'techproject'); ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('enablecvs', 'techproject') ?>:</b></td>
    <td>
        <!-- input type="radio" value="0" name="enablecvs" <?php echo (!$form->enablecvs) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('no') ?>
        <input type="radio" value="1" name="enablecvs" <?php echo ($form->enablecvs) ? "checked=\"checked\"" : "" ; ?> /> <?php print_string('yes') ?> -->
        <?php 
                choose_from_menu_yesno('enablecvs', @$form->useriskcorrection); 
                helpbutton('enablecvs', get_string('enablecvs', 'techproject'), 'techproject'); 
        ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string('useriskcorrection', 'techproject') ?>:</b></td>
    <td>
        <?php
        choose_from_menu_yesno('useriskcorrection', @$form->useriskcorrection); 
        helpbutton('enablecvs', get_string('enablecvs', 'techproject'), 'techproject'); 
        ?>
    </td>
</tr>

<?php print_standard_coursemodule_settings($form); ?>
</table>
<br />
<center>
<input type="hidden" name="course"     value="<?php  p($form->course) ?>" />
<input type="hidden" name="sesskey"    value="<?php  p($form->sesskey) ?>" />
<input type="hidden" name="coursemodule"  value="<?php  p($form->coursemodule) ?>" />
<input type="hidden" name="section"    value="<?php  p($form->section) ?>" />
<input type="hidden" name="module"     value="<?php  p($form->module) ?>" />
<input type="hidden" name="modulename" value="<?php  p($form->modulename) ?>" />
<input type="hidden" name="instance"   value="<?php  p($form->instance) ?>" />
<input type="hidden" name="mode"       value="<?php  p($form->mode) ?>" />
<input type="submit" value="<?php  print_string("savechanges") ?>" />
<input type="submit" name="cancel" value="<?php  print_string("cancel") ?>" />


</center>
</form>
